"use strict";(self.webpackChunkonekey_document=self.webpackChunkonekey_document||[]).push([[7660],{5756:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return o},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),s={sidebar_position:3},o="RPC API",l={unversionedId:"Extension/API Reference/rpc-api",id:"Extension/API Reference/rpc-api",isDocsHomePage:!1,title:"RPC API",description:"OneKey uses the onekey.request(args) method to wrap an RPC API.",source:"@site/docs/Extension/02-API Reference/rpc-api.md",sourceDirName:"Extension/02-API Reference",slug:"/Extension/API Reference/rpc-api",permalink:"/en/Extension/API Reference/rpc-api",editUrl:"https://github.com/onekeyhq/documents/edit/main/docs/Extension/02-API Reference/rpc-api.md",version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"ExtensionSidebar",previous:{title:"OneKey Provider API",permalink:"/en/Extension/API Reference/onekey-provider"},next:{title:"Signing Data",permalink:"/en/Extension/API Reference/signing-data"}},p=[{value:"Ethereum JSON-RPC Methods",id:"ethereum-json-rpc-methods",children:[]},{value:"Permissions",id:"permissions",children:[{value:"eth_requestAccounts",id:"eth_requestaccounts",children:[]},{value:"wallet_getPermissions",id:"wallet_getpermissions",children:[]},{value:"wallet_requestPermissions",id:"wallet_requestpermissions",children:[]}]},{value:"Other RPC Methods",id:"other-rpc-methods",children:[{value:"eth_decrypt",id:"eth_decrypt",children:[]},{value:"eth_getEncryptionPublicKey",id:"eth_getencryptionpublickey",children:[]},{value:"wallet_addEthereumChain",id:"wallet_addethereumchain",children:[]}]}],c={toc:p};function m(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"rpc-api"},"RPC API"),(0,r.kt)("p",null,"OneKey uses the ",(0,r.kt)("a",{parentName:"p",href:"./onekey-provider.html#onekey-request-args"},(0,r.kt)("inlineCode",{parentName:"a"},"onekey.request(args)")," method")," to wrap an RPC API."),(0,r.kt)("p",null,"The API is based on an interface exposed by all Ethereum clients, along with a growing number of methods that may or may not be supported by other wallets."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"All RPC method requests can return errors.\nMake sure to handle errors for every call to ",(0,r.kt)("inlineCode",{parentName:"p"},"onekey.request(args)"),"."))),(0,r.kt)("h2",{id:"ethereum-json-rpc-methods"},"Ethereum JSON-RPC Methods"),(0,r.kt)("p",null,"For the Ethereum JSON-RPC API, please see ",(0,r.kt)("a",{parentName:"p",href:"https://eth.wiki/json-rpc/API#json-rpc-methods"},"the Ethereum wiki"),"."),(0,r.kt)("p",null,"Important methods from this API include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eth.wiki/json-rpc/API#eth_accounts"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_accounts"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eth.wiki/json-rpc/API#eth_call"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_call"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eth.wiki/json-rpc/API#eth_getbalance"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_getBalance"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eth.wiki/json-rpc/API#eth_sendtransaction"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_sendTransaction"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eth.wiki/json-rpc/API#eth_sign"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_sign")))),(0,r.kt)("h2",{id:"permissions"},"Permissions"),(0,r.kt)("p",null,"OneKey introduced Web3 Wallet Permissions via ",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-2255"},"EIP-2255"),".\nIn this permissions system, each RPC method is either ",(0,r.kt)("em",{parentName:"p"},"restricted")," or ",(0,r.kt)("em",{parentName:"p"},"open"),".\nIf a method is restricted, an external ",(0,r.kt)("em",{parentName:"p"},"domain")," (like a web3 site) must have the corresponding permission in order to call it.\nOpen methods, meanwhile, do not require permissions to call, but may require confirmation by the user in order to succeed (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"eth_sendTransaction"),")."),(0,r.kt)("p",null,"Currently, the only permission is ",(0,r.kt)("inlineCode",{parentName:"p"},"eth_accounts"),", which allows you to access the user's Ethereum address(es).\nMore permissions will be added in the future."),(0,r.kt)("p",null,"Under the hood, permissions are plain, JSON-compatible objects, with a number of fields that are mostly used internally by OneKey.\nThe following interface lists the fields that may be of interest to consumers:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface Web3WalletPermission {\n  // The name of the method corresponding to the permission\n  parentCapability: string;\n\n  // The date the permission was granted, in UNIX epoch time\n  date?: number;\n}\n")),(0,r.kt)("p",null,"The permissions system is implemented in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/onekeyhq/rpc-cap"},(0,r.kt)("inlineCode",{parentName:"a"},"rpc-cap")," package"),".\nIf you're interested in learning more about the theory behind this ",(0,r.kt)("em",{parentName:"p"},"capability"),"-inspired permissions system, we encourage you to take a look at ",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-2255"},"EIP-2255"),"."),(0,r.kt)("h3",{id:"eth_requestaccounts"},"eth_requestAccounts"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"EIP-1102")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This method is specified by ",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-1102"},"EIP-1102"),".\nIt is equivalent to the deprecated ",(0,r.kt)("a",{parentName:"p",href:"./onekey-provider.html#onekey-enable"},(0,r.kt)("inlineCode",{parentName:"a"},"onekey.enable()"))," provider API method."),(0,r.kt)("p",{parentName:"div"},"Under the hood, it calls ",(0,r.kt)("a",{parentName:"p",href:"#wallet-requestpermissions"},(0,r.kt)("inlineCode",{parentName:"a"},"wallet_requestPermissions"))," for the ",(0,r.kt)("inlineCode",{parentName:"p"},"eth_accounts")," permission.\nSince ",(0,r.kt)("inlineCode",{parentName:"p"},"eth_accounts")," is currently the only permission, this method is all you need for now."))),(0,r.kt)("h4",{id:"returns"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"string[]")," - An array of a single, hexadecimal Ethereum address string."),(0,r.kt)("h4",{id:"description"},"Description"),(0,r.kt)("p",null,"Requests that the user provides an Ethereum address to be identified by.\nReturns a Promise that resolves to an array of a single Ethereum address string.\nIf the user denies the request, the Promise will reject with a ",(0,r.kt)("inlineCode",{parentName:"p"},"4001")," error."),(0,r.kt)("p",null,"The request causes a OneKey popup to appear.\nYou should only request the user's accounts in response to user action, such as a button click.\nYou should always disable the button that caused the request to be dispatched, while the request is still pending."),(0,r.kt)("p",null,"If you can't retrieve the user's account(s), you should encourage the user to initiate an account request."),(0,r.kt)("h4",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"document.getElementById('connectButton', connect);\n\nfunction connect() {\n  onekey\n    .request({ method: 'eth_requestAccounts' })\n    .then(handleAccountsChanged)\n    .catch((error) => {\n      if (error.code === 4001) {\n        // EIP-1193 userRejectedRequest error\n        console.log('Please connect to OneKey.');\n      } else {\n        console.error(error);\n      }\n    });\n}\n")),(0,r.kt)("h3",{id:"wallet_getpermissions"},"wallet_getPermissions"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Platform Availability")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This RPC method is not yet available in OneKey Mobile."))),(0,r.kt)("h4",{id:"returns-1"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Web3WalletPermission[]")," - An array of the caller's permissions."),(0,r.kt)("h4",{id:"description-1"},"Description"),(0,r.kt)("p",null,"Gets the caller's current permissions.\nReturns a Promise that resolves to an array of ",(0,r.kt)("inlineCode",{parentName:"p"},"Web3WalletPermission")," objects.\nIf the caller has no permissions, the array will be empty."),(0,r.kt)("h3",{id:"wallet_requestpermissions"},"wallet_requestPermissions"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Platform Availability")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This RPC method is not yet available in OneKey Mobile."))),(0,r.kt)("h4",{id:"parameters"},"Parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Array")),(0,r.kt)("ol",{parentName:"li",start:0},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"RequestedPermissions")," - The requested permissions.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface RequestedPermissions {\n  [methodName: string]: {}; // an empty object, for future extensibility\n}\n")),(0,r.kt)("h4",{id:"returns-2"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Web3WalletPermission[]")," - An array of the caller's permissions."),(0,r.kt)("h4",{id:"description-2"},"Description"),(0,r.kt)("p",null,"Requests the given permissions from the user.\nReturns a Promise that resolves to a non-empty array of ",(0,r.kt)("inlineCode",{parentName:"p"},"Web3WalletPermission")," objects, corresponding to the caller's current permissions.\nIf the user denies the request, the Promise will reject with a ",(0,r.kt)("inlineCode",{parentName:"p"},"4001")," error."),(0,r.kt)("p",null,"The request causes a OneKey popup to appear.\nYou should only request permissions in response to user action, such as a button click."),(0,r.kt)("h4",{id:"example-1"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"document.getElementById('requestPermissionsButton', requestPermissions);\n\nfunction requestPermissions() {\n  onekey\n    .request({\n      method: 'wallet_requestPermissions',\n      params: [{ eth_accounts: {} }],\n    })\n    .then((permissions) => {\n      const accountsPermission = permissions.find(\n        (permission) => permission.parentCapability === 'eth_accounts'\n      );\n      if (accountsPermission) {\n        console.log('eth_accounts permission successfully requested!');\n      }\n    })\n    .catch((error) => {\n      if (error.code === 4001) {\n        // EIP-1193 userRejectedRequest error\n        console.log('Permissions needed to continue.');\n      } else {\n        console.error(error);\n      }\n    });\n}\n")),(0,r.kt)("h2",{id:"other-rpc-methods"},"Other RPC Methods"),(0,r.kt)("h3",{id:"eth_decrypt"},"eth_decrypt"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Platform Availability")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This RPC method is not yet available in OneKey Mobile."))),(0,r.kt)("h4",{id:"parameters-1"},"Parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Array")),(0,r.kt)("ol",{parentName:"li",start:0},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"string")," - An encrypted message."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"string")," - The address of the Ethereum account that can decrypt the message.")))),(0,r.kt)("h4",{id:"returns-3"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"string")," - The decrypted message."),(0,r.kt)("h4",{id:"description-3"},"Description"),(0,r.kt)("p",null,"Requests that OneKey decrypts the given encrypted message.\nThe message must have been encrypted using the public encryption key of the given Ethereum address.\nReturns a Promise that resolves to the decrypted message, or rejects if the decryption attempt fails."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#eth-getencryptionpublickey"},(0,r.kt)("inlineCode",{parentName:"a"},"eth_getEncryptionPublicKey"))," for more information."),(0,r.kt)("h4",{id:"example-2"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"onekey\n  .request({\n    method: 'eth_decrypt',\n    params: [encryptedMessage, accounts[0]],\n  })\n  .then((decryptedMessage) =>\n    console.log('The decrypted message is:', decryptedMessage)\n  )\n  .catch((error) => console.log(error.message));\n")),(0,r.kt)("h3",{id:"eth_getencryptionpublickey"},"eth_getEncryptionPublicKey"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Platform Availability")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This RPC method is not yet available in OneKey Mobile."))),(0,r.kt)("h4",{id:"parameters-2"},"Parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Array")),(0,r.kt)("ol",{parentName:"li",start:0},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"string")," - The address of the Ethereum account whose encryption key should be retrieved.")))),(0,r.kt)("h4",{id:"returns-4"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"string")," - The public encryption key of the specified Ethereum account."),(0,r.kt)("h4",{id:"description-4"},"Description"),(0,r.kt)("p",null,"Requests that the user shares their public encryption key.\nReturns a Promise that resolve to the public encryption key, or rejects if the user denied the request."),(0,r.kt)("p",null,"The public key is computed from entropy associated with the specified user account, using the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dchest/tweetnacl-js"},(0,r.kt)("inlineCode",{parentName:"a"},"nacl"))," implementation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"X25519_XSalsa20_Poly1305")," algorithm."),(0,r.kt)("h4",{id:"example-3"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"let encryptionPublicKey;\n\nonekey\n  .request({\n    method: 'eth_getEncryptionPublicKey',\n    params: [accounts[0]], // you must have access to the specified account\n  })\n  .then((result) => {\n    encryptionPublicKey = result;\n  })\n  .catch((error) => {\n    if (error.code === 4001) {\n      // EIP-1193 userRejectedRequest error\n      console.log(\"We can't encrypt anything without the key.\");\n    } else {\n      console.error(error);\n    }\n  });\n")),(0,r.kt)("h4",{id:"encrypting"},"Encrypting"),(0,r.kt)("p",null,"The point of the encryption key is of course to encrypt things.\nHere's an example of how to encrypt a message using ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OneKeyhq/eth-sig-util"},(0,r.kt)("inlineCode",{parentName:"a"},"eth-sig-util")),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const ethUtil = require('ethereumjs-util');\n\nconst encryptedMessage = ethUtil.bufferToHex(\n  Buffer.from(\n    JSON.stringify(\n      sigUtil.encrypt(\n        encryptionPublicKey,\n        { data: 'Hello world!' },\n        'x25519-xsalsa20-poly1305'\n      )\n    ),\n    'utf8'\n  )\n);\n")),(0,r.kt)("h3",{id:"wallet_addethereumchain"},"wallet_addEthereumChain"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"EIP-3085")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This method is specified by ",(0,r.kt)("a",{parentName:"p",href:"https://eips.ethereum.org/EIPS/eip-3085"},"EIP-3085"),"."))),(0,r.kt)("h4",{id:"parameters-3"},"Parameters"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Array")),(0,r.kt)("ol",{parentName:"li",start:0},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"AddEthereumChainParameter")," - Metadata about the chain that will be added to OneKey.")))),(0,r.kt)("p",null,"For the ",(0,r.kt)("inlineCode",{parentName:"p"},"rpcUrls")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"blockExplorerUrls")," arrays, at least one element is required, and only the first element will be used."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface AddEthereumChainParameter {\n  chainId: string; // A 0x-prefixed hexadecimal string\n  chainName: string;\n  nativeCurrency: {\n    name: string;\n    symbol: string; // 2-6 characters long\n    decimals: 18;\n  };\n  rpcUrls: string[];\n  blockExplorerUrls?: string[];\n  iconUrls?: string[]; // Currently ignored.\n}\n")),(0,r.kt)("h4",{id:"returns-5"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"null")," - The method returns ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," if the request was successful, and an error otherwise."),(0,r.kt)("h4",{id:"description-5"},"Description"),(0,r.kt)("p",null,"Creates a confirmation asking the user to add the specified chain to OneKey.\nThe user may choose to switch to the chain once it has been added."),(0,r.kt)("p",null,"As with any method that causes a confirmation to appear, ",(0,r.kt)("inlineCode",{parentName:"p"},"wallet_addEthereumChain"),"\nshould ",(0,r.kt)("strong",{parentName:"p"},"only")," be called as a result of direct user action, such as the click of a button."),(0,r.kt)("p",null,"OneKey stringently validates the parameters for this method, and will reject the request\nif any parameter is incorrectly formatted.\nIn addition, OneKey will reject the request under the following circumstances:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If the RPC endpoint doesn't respond to RPC calls."),(0,r.kt)("li",{parentName:"ul"},"If the RPC endpoint returns a different chain ID when ",(0,r.kt)("inlineCode",{parentName:"li"},"eth_chainId")," is called."),(0,r.kt)("li",{parentName:"ul"},"If the chain ID corresponds to any default OneKey chains.")),(0,r.kt)("p",null,"OneKey does not yet support chains with native currencies that do not have 18 decimals,\nbut may do so in the future."))}m.isMDXComponent=!0}}]);